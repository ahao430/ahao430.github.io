<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>python生成pdf报告 | 王昊的个人博客</title>
    <meta name="description" content="前端">
    
    
    <link rel="preload" href="/assets/css/0.styles.7f50033a.css" as="style"><link rel="preload" href="/assets/js/app.df436686.js" as="script"><link rel="preload" href="/assets/js/11.05267775.js" as="script"><link rel="prefetch" href="/assets/js/10.8434dcff.js"><link rel="prefetch" href="/assets/js/12.df6d9c5b.js"><link rel="prefetch" href="/assets/js/13.21976a23.js"><link rel="prefetch" href="/assets/js/14.adeb946a.js"><link rel="prefetch" href="/assets/js/15.05695498.js"><link rel="prefetch" href="/assets/js/16.25b6b60c.js"><link rel="prefetch" href="/assets/js/17.29da1f0d.js"><link rel="prefetch" href="/assets/js/18.d5ac0d11.js"><link rel="prefetch" href="/assets/js/19.d33bd39b.js"><link rel="prefetch" href="/assets/js/2.bd311f47.js"><link rel="prefetch" href="/assets/js/20.1a54c413.js"><link rel="prefetch" href="/assets/js/21.3e37a615.js"><link rel="prefetch" href="/assets/js/22.f9b638cf.js"><link rel="prefetch" href="/assets/js/23.3b83adb9.js"><link rel="prefetch" href="/assets/js/3.d1de4629.js"><link rel="prefetch" href="/assets/js/4.102c42f8.js"><link rel="prefetch" href="/assets/js/5.64c0317a.js"><link rel="prefetch" href="/assets/js/6.f0ab4840.js"><link rel="prefetch" href="/assets/js/7.37b04fc2.js"><link rel="prefetch" href="/assets/js/8.02e51ca2.js"><link rel="prefetch" href="/assets/js/9.321af1f8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7f50033a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">王昊的个人博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">资源</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.iconfont.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里巴巴图标库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://apizza.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Apizza
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.codewars.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Codewars
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://leetcode-cn.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.ruanyifeng.com/home.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阮一峰
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.zhangxinxu.com/wordpress/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  张鑫旭
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  廖雪峰
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">资源</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.iconfont.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里巴巴图标库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://apizza.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Apizza
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.codewars.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Codewars
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://leetcode-cn.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.ruanyifeng.com/home.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阮一峰
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.zhangxinxu.com/wordpress/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  张鑫旭
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  廖雪峰
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/dev/小程序开发填坑总结.html" class="sidebar-link">小程序开发填坑总结</a></li><li><a href="/dev/公众号h5自定义分享.html" class="sidebar-link">公众号h5自定义分享</a></li><li><a href="/dev/小程序使用async和await.html" class="sidebar-link">在小程序中使用async/await</a></li><li><a href="/dev/chrome插件开发.html" class="sidebar-link">chrome插件开发</a></li><li><a href="/dev/rollup使用.html" class="sidebar-link">rollup使用教程</a></li><li><a href="/dev/jsPdf生成pdf.html" class="sidebar-link">jspdf生成Pdf文档</a></li><li><a href="/dev/vue的provide和inject方法.html" class="sidebar-link">vue的provide和inject方法</a></li><li><a href="/dev/vue刷新页面.html" class="sidebar-link">vue刷新页面</a></li><li><a href="/dev/vue-cli项目的环境编译.html" class="sidebar-link">vue-cli项目的环境编译</a></li><li><a href="/dev/nvm版本管理.html" class="sidebar-link">nvm版本管理</a></li><li><a href="/dev/npm源管理.html" class="sidebar-link">npm源管理</a></li><li><a href="/dev/外卖小程序首页商品列表和购物车的优化.html" class="sidebar-link">外卖小程序首页商品列表和购物车的优化</a></li><li><a href="/dev/svg的响应式.html" class="sidebar-link">svg的响应式</a></li><li><a href="/dev/python生成pdf报告.html" class="active sidebar-link">python生成pdf报告</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/python生成pdf报告.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/dev/python生成pdf报告.html#方案" class="sidebar-link">方案</a></li><li class="sidebar-sub-header"><a href="/dev/python生成pdf报告.html#环境" class="sidebar-link">环境</a></li><li class="sidebar-sub-header"><a href="/dev/python生成pdf报告.html#reportlab简介" class="sidebar-link">reportlab简介</a></li><li class="sidebar-sub-header"><a href="/dev/python生成pdf报告.html#pyecharts简介" class="sidebar-link">pyecharts简介</a></li><li class="sidebar-sub-header"><a href="/dev/python生成pdf报告.html#遇到的问题" class="sidebar-link">遇到的问题</a></li><li class="sidebar-sub-header"><a href="/dev/python生成pdf报告.html#代码实现" class="sidebar-link">代码实现</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="python生成pdf报告"><a href="#python生成pdf报告" class="header-anchor">#</a> python生成pdf报告</h1> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>项目需求生成测试报告，之前用<a href="/dev/jsPdf生成pdf.html">前端实现</a>，由于dom操作较慢，且每次生成报告都要渲染一遍，计划改为使用后端实现。经过调研采用python库reportlab来实现。</p> <h2 id="方案"><a href="#方案" class="header-anchor">#</a> 方案</h2> <ul><li>主要使用<a href="https://www.reportlab.com/docs/reportlab-userguide.pdf" target="_blank" rel="noopener noreferrer">reportlab<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。对简单的表格段落等排版，通过模板方法实现。对复杂的排版，类似canvas的方法来画。</li> <li>另外对于各种数据图，使用<a href="http://pyecharts.org/" target="_blank" rel="noopener noreferrer">pyecharts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来处理，较自己实现更便捷好看。</li></ul> <h2 id="环境"><a href="#环境" class="header-anchor">#</a> 环境</h2> <p>使用python3运行环境，需要安装reportlab库及相关库，需要安装pyecharts库及chromeDriver。</p> <ul><li>命令：<div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> reportlab
pip <span class="token function">install</span> pyecharts
pip <span class="token function">install</span> echarts-countries-pypkg    
pip <span class="token function">install</span> selenium
pip <span class="token function">install</span> pyvirtualdisplay selenium
pip <span class="token function">install</span> snapshot_selenium
</code></pre></div></li> <li>下载对应浏览器版本号的<a href="http://npm.taobao.org/mirrors/chromedriver/" target="_blank" rel="noopener noreferrer">chromeDriver<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，并配置到环境变量。这是pyecharts需要。pyecharts是调用chromeDriver渲染html，再快照生成图片。</li></ul> <h2 id="reportlab简介"><a href="#reportlab简介" class="header-anchor">#</a> reportlab简介</h2> <p>reportlab是Python的一个标准库，可以画图、画表格、编辑文字，最后可以输出PDF格式。</p> <ul><li>reportlab不支持中文，需要自己下载中文字体并注册。<div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 设置中文字体</span>
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>pdfbase <span class="token keyword">import</span> pdfmetrics
pdfmetrics<span class="token punctuation">.</span>registerFont<span class="token punctuation">(</span>TTFont<span class="token punctuation">(</span><span class="token string">'SimSun'</span><span class="token punctuation">,</span> <span class="token string">'./Fonts/SimSun.ttf'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>reportlab可以创建canvas的方式来创建pdf<div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>pdfgen <span class="token keyword">import</span> canvas
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>pdfbase<span class="token punctuation">.</span>ttfonts <span class="token keyword">import</span> TTFont
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>pdfbase <span class="token keyword">import</span> pdfmetrics
pdfmetrics<span class="token punctuation">.</span>registerFont<span class="token punctuation">(</span>TTFont<span class="token punctuation">(</span><span class="token string">'SimHei'</span><span class="token punctuation">,</span> <span class="token string">'SimHei.TTF'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>
    c<span class="token punctuation">.</span>drawString<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;世界你好&quot;</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> canvas<span class="token punctuation">.</span>Canvas<span class="token punctuation">(</span><span class="token string">&quot;hello.pdf&quot;</span><span class="token punctuation">)</span>
c<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span><span class="token string">'SimHei'</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span>
hello<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
c<span class="token punctuation">.</span>showPage<span class="token punctuation">(</span><span class="token punctuation">)</span>
c<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>reportlab也可以通过模板，创建一个元素列表来创建pdf<div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>pdfbase <span class="token keyword">import</span> pdfmetrics
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>pdfbase<span class="token punctuation">.</span>ttfonts <span class="token keyword">import</span> TTFont
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>styles <span class="token keyword">import</span> getSampleStyleSheet<span class="token punctuation">,</span>ParagraphStyle
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>platypus <span class="token keyword">import</span> SimpleDocTemplate<span class="token punctuation">,</span> Paragraph<span class="token punctuation">,</span> Spacer<span class="token punctuation">,</span>Image<span class="token punctuation">,</span>Table<span class="token punctuation">,</span>TableStyle<span class="token punctuation">,</span>Frame<span class="token punctuation">,</span>ListFlowable<span class="token punctuation">,</span> ListItem
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>enums <span class="token keyword">import</span> TA_JUSTIFY
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib <span class="token keyword">import</span> colors
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>colors <span class="token keyword">import</span> CMYKColor

story<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">#建立空白的list</span>

<span class="token comment">### 设置中文字体名称为msyh</span>
pdfmetrics<span class="token punctuation">.</span>registerFont<span class="token punctuation">(</span>TTFont<span class="token punctuation">(</span><span class="token string">'msyh'</span><span class="token punctuation">,</span> <span class="token string">'/Users/cello/Library/Fonts/YAHEI.ttf'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#获得reportlab预先设定的文本模板</span>
styles <span class="token operator">=</span> getSampleStyleSheet<span class="token punctuation">(</span><span class="token punctuation">)</span>
styles<span class="token punctuation">.</span>add<span class="token punctuation">(</span>ParagraphStyle<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'txt'</span><span class="token punctuation">,</span> leftIndent<span class="token operator">=</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span>rightIndent<span class="token operator">=</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span>alignment<span class="token operator">=</span>TA_JUSTIFY<span class="token punctuation">,</span>fontName<span class="token operator">=</span><span class="token string">&quot;msyh&quot;</span><span class="token punctuation">,</span>fontSize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>textColor<span class="token operator">=</span><span class="token string">'#003153'</span><span class="token punctuation">,</span>bulletFontSize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span>bulletIndent<span class="token operator">=</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span>bulletAnchor <span class="token operator">=</span><span class="token string">'start'</span><span class="token punctuation">,</span>bulletFontName <span class="token operator">=</span> <span class="token string">'Symbol'</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
        
text <span class="token operator">=</span> <span class="token triple-quoted-string string">'''&lt;para&gt;&lt;br/&gt;第一部分：建立文本说明&lt;/para&gt;'''</span>
story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Paragraph<span class="token punctuation">(</span>text<span class="token punctuation">,</span>styles<span class="token punctuation">[</span><span class="token string">&quot;txt&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 

my_list <span class="token operator">=</span> ListFlowable<span class="token punctuation">(</span><span class="token punctuation">[</span>
    ListItem<span class="token punctuation">(</span>Paragraph<span class="token punctuation">(</span><span class="token string">'小红XXXXXXXXXXXX'</span><span class="token punctuation">,</span> styles<span class="token punctuation">[</span><span class="token string">&quot;txt&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             leftIndent<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">'diamondwx'</span><span class="token punctuation">,</span>bulletFontSize<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>
             bulletColor<span class="token operator">=</span>CMYKColor<span class="token punctuation">(</span><span class="token number">0.81</span><span class="token punctuation">,</span> <span class="token number">0.45</span><span class="token punctuation">,</span> <span class="token number">0.53</span><span class="token punctuation">,</span> <span class="token number">0.23</span><span class="token punctuation">)</span>
             <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#添加文本，并设置bullet的位置、形状、大小、颜色</span>
    ListItem<span class="token punctuation">(</span>Paragraph<span class="token punctuation">(</span><span class="token string">&quot;&lt;b&gt;  &lt;br/&gt;&lt;/b&gt;&quot;</span><span class="token punctuation">,</span> styles<span class="token punctuation">[</span><span class="token string">&quot;txt&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             bulletColor<span class="token operator">=</span>CMYKColor<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 空一行，将bullet的颜色设置为和背景一样的</span>
    ListItem<span class="token punctuation">(</span>Paragraph<span class="token punctuation">(</span><span class="token string">'小蓝XXXXXXXXXXXX'</span><span class="token punctuation">,</span> styles<span class="token punctuation">[</span><span class="token string">&quot;txt&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             leftIndent<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">'diamondwx'</span><span class="token punctuation">,</span>bulletFontSize<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>
             bulletColor<span class="token operator">=</span>CMYKColor<span class="token punctuation">(</span><span class="token number">0.81</span><span class="token punctuation">,</span> <span class="token number">0.45</span><span class="token punctuation">,</span> <span class="token number">0.53</span><span class="token punctuation">,</span> <span class="token number">0.23</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
    start<span class="token operator">=</span><span class="token string">'sparkle'</span><span class="token punctuation">,</span>
    leftIndent<span class="token operator">=</span><span class="token number">60</span>
<span class="token punctuation">)</span>
story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>my_list <span class="token punctuation">)</span>
<span class="token comment"># 生成文档</span>
doc <span class="token operator">=</span> SimpleDocTemplate<span class="token punctuation">(</span>path <span class="token operator">+</span><span class="token string">'test'</span><span class="token operator">+</span><span class="token string">'.pdf'</span><span class="token punctuation">,</span>pagesize<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span>，<span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>topMargin <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">,</span>bottomMargin <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>build<span class="token punctuation">(</span>story<span class="token punctuation">)</span>
</code></pre></div></li></ul> <p>在这里，我使用的第二种方法，对于大部分的图表来说，自动排版会更好，而非对canvas一点一点的编写。</p> <h4 id="simpledoctemplate常用模块和方法："><a href="#simpledoctemplate常用模块和方法：" class="header-anchor">#</a> simpleDocTemplate常用模块和方法：</h4> <ul><li>颜色、单位、尺寸等等<div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>styles <span class="token keyword">import</span> getSampleStyleSheet<span class="token punctuation">,</span> ParagraphStyle <span class="token comment"># 样式</span>
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>pagesizes <span class="token keyword">import</span> A4<span class="token punctuation">,</span> landscape<span class="token punctuation">,</span> portrait <span class="token comment"># 尺寸</span>
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>pdfbase <span class="token keyword">import</span> pdfmetrics 
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>pdfbase<span class="token punctuation">.</span>ttfonts <span class="token keyword">import</span> TTFont <span class="token comment"># 字体，设置中文见前面</span>
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>enums <span class="token keyword">import</span> TA_JUSTIFY<span class="token punctuation">,</span> TA_CENTER <span class="token comment"># 对齐</span>
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib <span class="token keyword">import</span> colors <span class="token comment"># 颜色</span>
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>units <span class="token keyword">import</span> inch<span class="token punctuation">,</span> mm <span class="token comment"># 单位</span>
</code></pre></div></li> <li>分页
在canvas中可以通过canvas.showPage()来插入分页，在simpleDocTemplate中，通过PageBreak来实现。<div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>platypus <span class="token keyword">import</span> SimpleDocTemplate<span class="token punctuation">,</span> PageBreak

story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>PageBreak<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>页眉页脚
SimpleDocTemplate可以设置onFirstPage和onLaterPages两个钩子，在这里可以设置页眉页脚。要注意这里是要用到canvas绘制。<div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">generatePdf</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pagesData<span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 生成文件，自动按照横向A4大小分页</span>
    doc <span class="token operator">=</span> SimpleDocTemplate<span class="token punctuation">(</span>reportName<span class="token punctuation">,</span> pagesize<span class="token operator">=</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>PAGE_WIDTH<span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">,</span> leftMargin<span class="token operator">=</span><span class="token number">0.5</span><span class="token operator">*</span>inch<span class="token punctuation">,</span> rightMargin<span class="token operator">=</span><span class="token number">0.5</span><span class="token operator">*</span>inch<span class="token punctuation">)</span>
    doc<span class="token punctuation">.</span>multiBuild<span class="token punctuation">(</span>self<span class="token punctuation">.</span>story<span class="token punctuation">,</span> onFirstPage<span class="token operator">=</span>self<span class="token punctuation">.</span>myFirstPage<span class="token punctuation">,</span> onLaterPages<span class="token operator">=</span>self<span class="token punctuation">.</span>myLaterPages<span class="token punctuation">)</span>
    <span class="token comment"># 首页钩子，插入页眉页脚</span>
<span class="token keyword">def</span> <span class="token function">myFirstPage</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
    canvas<span class="token punctuation">.</span>saveState<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>renderHeader<span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>renderFooter<span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span>
    canvas<span class="token punctuation">.</span>restoreState<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 其他页面钩子，插入页眉页脚</span>
<span class="token keyword">def</span> <span class="token function">myLaterPages</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
    canvas<span class="token punctuation">.</span>saveState<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>renderHeader<span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>renderFooter<span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span>
    canvas<span class="token punctuation">.</span>restoreState<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 渲染页眉</span>
<span class="token keyword">def</span> <span class="token function">renderHeader</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
    padding <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token comment"># Logo</span>
    logo_width <span class="token operator">=</span> <span class="token number">127</span>
    logo_height <span class="token operator">=</span> <span class="token number">50</span>
    canvas<span class="token punctuation">.</span>drawImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>logo<span class="token punctuation">,</span> padding<span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_HEIGHT <span class="token operator">-</span> logo_height <span class="token operator">-</span> padding<span class="token punctuation">,</span> width<span class="token operator">=</span>logo_width<span class="token punctuation">,</span> height<span class="token operator">=</span>logo_height<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token string">'auto'</span><span class="token punctuation">)</span>
    <span class="token comment"># Title</span>
    canvas<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span><span class="token string">'Times-Bold'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    canvas<span class="token punctuation">.</span>drawCentredString<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PAGE_WIDTH <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_HEIGHT <span class="token operator">-</span> padding <span class="token operator">-</span> <span class="token number">24</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">[</span><span class="token string">'subtitle'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
      canvas<span class="token punctuation">.</span>drawCentredString<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PAGE_WIDTH <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_HEIGHT <span class="token operator">-</span> padding <span class="token operator">-</span> <span class="token number">24</span> <span class="token operator">-</span> <span class="token number">24</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">[</span><span class="token string">'subtitle'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># Company Logo</span>
    company_logo_width <span class="token operator">=</span> <span class="token number">50</span>
    company_logo_height <span class="token operator">=</span> <span class="token number">50</span>
    canvas<span class="token punctuation">.</span>drawImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>company_logo<span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_WIDTH <span class="token operator">-</span> company_logo_width <span class="token operator">-</span> padding<span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_HEIGHT <span class="token operator">-</span> company_logo_height <span class="token operator">-</span> padding<span class="token punctuation">,</span> width<span class="token operator">=</span>company_logo_width<span class="token punctuation">,</span> height<span class="token operator">=</span>company_logo_height<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token string">'auto'</span><span class="token punctuation">)</span>

<span class="token comment"># 渲染页脚</span>
<span class="token keyword">def</span> <span class="token function">renderFooter</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
    padding <span class="token operator">=</span> <span class="token number">20</span>
    canvas<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span><span class="token string">'Times-Roman'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
    canvas<span class="token punctuation">.</span>drawCentredString<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PAGE_WIDTH <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token punctuation">,</span> <span class="token string">&quot;%s&quot;</span> <span class="token operator">%</span> doc<span class="token punctuation">.</span>page<span class="token punctuation">)</span>
</code></pre></div></li> <li>常用模块
通过reportlab.platypus引入各种模块。<div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>platypus <span class="token keyword">import</span> SimpleDocTemplate<span class="token punctuation">,</span> Paragraph<span class="token punctuation">,</span> Spacer<span class="token punctuation">,</span> Image<span class="token punctuation">,</span> Table<span class="token punctuation">,</span> TableStyle<span class="token punctuation">,</span> Frame<span class="token punctuation">,</span> ListFlowable<span class="token punctuation">,</span> ListItem<span class="token punctuation">,</span> PageBreak
</code></pre></div><ul><li>Paragraph
段落，可插入文字及html字符串，并设置样式。</li> <li>Spacer
一个指定长宽的空白块</li> <li>Image
图片</li> <li>Table, TableStyle
表格</li> <li>ListFlowable, ListItem
无序列表，有小圆点。</li></ul></li> <li>表格<div class="language-python extra-class"><pre class="language-python"><code>table_widths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span>
table_data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'Control'</span><span class="token punctuation">,</span> <span class="token string">'Number'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'Sent'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'Hits'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'Misses'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
table_style <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">'FONTNAME'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'SimSun'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 字体</span>
    <span class="token punctuation">(</span><span class="token string">'FONTSIZE'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>colsLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 第一行的字体大小</span>
    <span class="token punctuation">(</span><span class="token string">'FONTSIZE'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 第二行到最后一行的字体大小</span>
    <span class="token punctuation">(</span><span class="token string">'ALIGN'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>colsLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'CENTER'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 第一行左右中间对齐</span>
    <span class="token punctuation">(</span><span class="token string">'ALIGN'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>colsLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> rowsLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'CENTER'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 第二行到最后一行左右左对齐</span>
    <span class="token punctuation">(</span><span class="token string">'VALIGN'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>colsLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> rowsLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'MIDDLE'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 所有表格上下居中对齐</span>
    <span class="token punctuation">(</span><span class="token string">'BACKGROUND'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>colsLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colors<span class="token punctuation">.</span>lightslategray<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 设置第一行背景颜色</span>
    <span class="token punctuation">(</span><span class="token string">'TEXTCOLOR'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colors<span class="token punctuation">.</span>darkslategray<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 设置表格内文字颜色</span>
    <span class="token punctuation">(</span><span class="token string">'GRID'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> colors<span class="token punctuation">.</span>slategray<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 设置表格框线为灰色，线宽为0.1</span>
<span class="token punctuation">]</span>
table_table <span class="token operator">=</span> Table<span class="token punctuation">(</span>table_data<span class="token punctuation">,</span> colWidths<span class="token operator">=</span>table_widths<span class="token punctuation">,</span> repeatRows<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> style<span class="token operator">=</span>table_style<span class="token punctuation">)</span>
story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>table_table<span class="token punctuation">)</span>
</code></pre></div>其中，repeatRows表示如果表格分页，顶部重复的行数。
另外，遇到表格单元格文字过长导致页面显示不下的问题。试了下加入\n可以实现换行。故通过工具函数对字符串定长添加\n来定制解决。<div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 计算字符串宽度</span>
<span class="token keyword">def</span> <span class="token function">getStrLength</span> <span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">:</span>
  lenTxt <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span> 
  lenTxt_utf8 <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>txt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
  size <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>lenTxt_utf8 <span class="token operator">-</span> lenTxt<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> lenTxt<span class="token punctuation">)</span>
  <span class="token keyword">return</span> size

<span class="token keyword">def</span> <span class="token function">addLF2Str</span> <span class="token punctuation">(</span>txt<span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">:</span>
  res <span class="token operator">=</span> <span class="token string">''</span>
  l <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> c <span class="token keyword">in</span> txt<span class="token punctuation">:</span>
    lc <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    res <span class="token operator">+=</span> c
    l <span class="token operator">+=</span> lc
    <span class="token keyword">if</span> l <span class="token operator">&gt;=</span> interval<span class="token punctuation">:</span>
      l <span class="token operator">=</span> <span class="token number">0</span>
      res <span class="token operator">+=</span> <span class="token string">'\n'</span>
  <span class="token keyword">return</span> res
</code></pre></div></li> <li>画图<div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>shapes <span class="token keyword">import</span> Drawing<span class="token punctuation">,</span> Rect<span class="token punctuation">,</span> String<span class="token punctuation">,</span> Line<span class="token punctuation">,</span> Circle<span class="token punctuation">,</span> Ellipse<span class="token punctuation">,</span>ArcPath<span class="token punctuation">,</span> Group
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>charts<span class="token punctuation">.</span>lineplots <span class="token keyword">import</span> LinePlot
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>charts<span class="token punctuation">.</span>textlabels <span class="token keyword">import</span> Label
</code></pre></div>shapes中的Drawing类似于一块画布，其他元素可以添加到Drawing上，再插入到列表中渲染。在项目的一些复杂布局中有用到。Group可以对一些元素放到一组，便于整体的移动布局。
而charts是自带的一些线图、饼图等基本数据图形，我们使用pyecharts代替。<div class="language-python extra-class"><pre class="language-python"><code>d <span class="token operator">=</span> Drawing<span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">350</span><span class="token punctuation">)</span>
d<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Rect<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">350</span><span class="token punctuation">,</span> strokeColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>transparent<span class="token punctuation">,</span> fillColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>HexColor<span class="token punctuation">(</span><span class="token string">'#30314d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 标题</span>
d<span class="token punctuation">.</span>add<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">310</span><span class="token punctuation">,</span> <span class="token string">'Latest Test: '</span> <span class="token operator">+</span> test<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fontSize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>fillColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>fontName<span class="token operator">=</span><span class="token string">'SimSun'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># major source 和 top Missed</span>
<span class="token keyword">def</span> <span class="token function">drawTable1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  topMissedStr <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">for</span> item <span class="token keyword">in</span> test<span class="token punctuation">[</span><span class="token string">'topMissed'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> item<span class="token punctuation">:</span>
      topMissedStr <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span>
  g <span class="token operator">=</span> Group<span class="token punctuation">(</span>
    Line<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">260</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span>strokeColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>HexColor<span class="token punctuation">(</span><span class="token string">'#6d6e74'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Line<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">260</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span>strokeColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>HexColor<span class="token punctuation">(</span><span class="token string">'#6d6e74'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Line<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">260</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>strokeColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>HexColor<span class="token punctuation">(</span><span class="token string">'#6d6e74'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Rect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> strokeColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>transparent<span class="token punctuation">,</span> fillColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>toColor<span class="token punctuation">(</span><span class="token string">'rgb(38,39,64)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token string">'Weak Alias Tested: '</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'√'</span> <span class="token keyword">if</span> test<span class="token punctuation">[</span><span class="token string">'weakAliasTested'</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token string">'×'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'  Major Source: '</span> <span class="token operator">+</span> test<span class="token punctuation">[</span><span class="token string">'majorSource'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fontSize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>fillColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>fontName<span class="token operator">=</span><span class="token string">'SimSun'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'Top Missed:  '</span> <span class="token operator">+</span> topMissedStr<span class="token punctuation">,</span> fontSize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>fillColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>fontName<span class="token operator">=</span><span class="token string">'SimSun'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
  <span class="token comment"># 弧线</span>
  arc1 <span class="token operator">=</span> ArcPath<span class="token punctuation">(</span>strokeColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>toColor<span class="token punctuation">(</span><span class="token string">'rgb(60,190,176)'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fillColor<span class="token operator">=</span>colors<span class="token punctuation">.</span>transparent<span class="token punctuation">)</span>
  arc1<span class="token punctuation">.</span>addArc<span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token operator">+</span>pure_angle<span class="token punctuation">)</span> <span class="token comment"># 中心x，中心y，半径，startAngle，endAngle</span>
  g<span class="token punctuation">.</span>add<span class="token punctuation">(</span>arc1<span class="token punctuation">)</span>
  g<span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">270</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> g
d<span class="token punctuation">.</span>add<span class="token punctuation">(</span>drawTable1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>d<span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="pyecharts简介"><a href="#pyecharts简介" class="header-anchor">#</a> pyecharts简介</h2> <p>pyecharts是在百度echarts基础上封装的一个python库，可以像echarts一样通过设置配置生成各种图形。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> Bar
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>render <span class="token keyword">import</span> make_snapshot

<span class="token comment"># 使用 snapshot-selenium 渲染图片</span>
<span class="token keyword">from</span> snapshot_selenium <span class="token keyword">import</span> snapshot

bar <span class="token operator">=</span> <span class="token punctuation">(</span>
    Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;衬衫&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;羊毛衫&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;雪纺衫&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;裤子&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;高跟鞋&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;袜子&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">&quot;商家A&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
make_snapshot<span class="token punctuation">(</span>snapshot<span class="token punctuation">,</span> bar<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;bar.png&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>make_snapshot将渲染的图形保存为图片，再用Image读取这个图片，append到story中即可。这里涉及到调用chromeDriver，频繁开关耗费时间，对其做了一些优化。</p> <h2 id="遇到的问题"><a href="#遇到的问题" class="header-anchor">#</a> 遇到的问题</h2> <ul><li>文字换行
表格中有时会遇到返回的字段文字太长，导致表格超出页面。试了一下，插入\n可以解决。这样就可以写一个函数，指定字符串达到某个宽度自动插入\n来解决。<div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">getStrLength</span> <span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">:</span>
  lenTxt <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span>
  lenTxt_utf8 <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>txt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  size <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>lenTxt_utf8 <span class="token operator">-</span> lenTxt<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> lenTxt<span class="token punctuation">)</span>
  <span class="token keyword">return</span> size

<span class="token keyword">def</span> <span class="token function">addLF2Str</span> <span class="token punctuation">(</span>txt<span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> <span class="token string">''</span>
    l <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> c <span class="token keyword">in</span> txt<span class="token punctuation">:</span>
        lc <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        res <span class="token operator">+=</span> c
        l <span class="token operator">+=</span> lc
        <span class="token keyword">if</span> l <span class="token operator">&gt;=</span> interval<span class="token punctuation">:</span>
            l <span class="token operator">=</span> <span class="token number">0</span>
            res <span class="token operator">+=</span> <span class="token string">'\n'</span>
    <span class="token keyword">return</span> res
</code></pre></div></li> <li>自动中英文字体
虽然reportlab可以注册中文字体解决中文显示问题，但是实际开发中遇到一个问题，就是中文字体自带的英文并不好看，而reportlab并不像网页一样可以设置一系列字体自动适应。虽然可以注册多个字体，但是对一个字符串只能指定一种。而实际自动生成代码时，并不知道服务端返回的数据是中文还是英文。
最后想到一个办法，把中文字体的英文部分替换成需要的英文字体应该就可以了，上网搜了<a href="https://github.com/nowar-fonts/Warcraft-Font-Merger/releases/tag/v0.3.3" target="_blank" rel="noopener noreferrer">一个合并字体的工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>成功实现。</li></ul> <h2 id="代码实现"><a href="#代码实现" class="header-anchor">#</a> 代码实现</h2> <p>项目结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>├── components
│   ├── myBar.py
│   ├── myLine.py
│   ├── myMap.py
│   ├── myPie.py
│   └── myTable.py
├── data
│   ├── analysis.json
│   ├── logo_big.png
├── Fonts
│   └── SimSun.ttf
├── img
├── pages
│   ├── detail.py
│   ├── summary.py
│   └── testInfo.py
├── .gitignore
├── generate.py
├── index.py
├── README.md
├── snapshot.py
└── utils.py
</code></pre></div><p>将一些报告数据放到data文件夹中，在index中通过json读取并调用Generator类生成报告。结束后关闭chromeDriver进程。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># index.py</span>
<span class="token keyword">import</span> json
<span class="token keyword">import</span> io
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> utils <span class="token keyword">import</span> timer<span class="token punctuation">,</span> get_chrome_driver
<span class="token keyword">from</span> generate <span class="token keyword">import</span> Generator
<span class="token keyword">import</span> os

sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> io<span class="token punctuation">.</span>TextIOWrapper<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@timer</span>
<span class="token keyword">def</span> <span class="token function">generate_report</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Generator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>generatePdf<span class="token punctuation">(</span>data<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    chrome_driver <span class="token operator">=</span> get_chrome_driver<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># analysis</span>
    <span class="token comment"># f = open('data/analysis.json', encoding='utf-8')</span>
    <span class="token comment"># peertest</span>
    <span class="token comment"># f = open('data/peertest.json', encoding='utf-8')</span>
    <span class="token comment"># dashboard</span>
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data/dashboard.json'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

    d <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span>
    <span class="token comment"># print(chrome_driver.session_id)</span>
    generate_report<span class="token punctuation">(</span>chrome_driver<span class="token punctuation">,</span> d<span class="token punctuation">)</span>
    chrome_driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    chrome_driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># snapshot.py</span>
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> codecs
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> os
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

PNG_FORMAT <span class="token operator">=</span> <span class="token string">&quot;png&quot;</span>
JPG_FORMAT <span class="token operator">=</span> <span class="token string">&quot;jpeg&quot;</span>
GIF_FORMAT <span class="token operator">=</span> <span class="token string">&quot;gif&quot;</span>
PDF_FORMAT <span class="token operator">=</span> <span class="token string">&quot;pdf&quot;</span>
SVG_FORMAT <span class="token operator">=</span> <span class="token string">&quot;svg&quot;</span>
EPS_FORMAT <span class="token operator">=</span> <span class="token string">&quot;eps&quot;</span>
B64_FORMAT <span class="token operator">=</span> <span class="token string">&quot;base64&quot;</span>


<span class="token keyword">def</span> <span class="token function">make_snapshot</span><span class="token punctuation">(</span>
        engine<span class="token punctuation">,</span>
        file_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
        output_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
        delay<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
        pixel_ratio<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
        is_remove_html<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
        <span class="token operator">**</span>kwargs<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;Generating file ...&quot;</span><span class="token punctuation">)</span>
    file_type <span class="token operator">=</span> output_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

    content <span class="token operator">=</span> engine<span class="token punctuation">.</span>make_snapshot<span class="token punctuation">(</span>
        html_path<span class="token operator">=</span>file_name<span class="token punctuation">,</span>
        file_type<span class="token operator">=</span>file_type<span class="token punctuation">,</span>
        delay<span class="token operator">=</span>delay<span class="token punctuation">,</span>
        pixel_ratio<span class="token operator">=</span>pixel_ratio<span class="token punctuation">,</span>
        <span class="token operator">**</span>kwargs<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">if</span> file_type <span class="token keyword">in</span> <span class="token punctuation">[</span>SVG_FORMAT<span class="token punctuation">,</span> B64_FORMAT<span class="token punctuation">]</span><span class="token punctuation">:</span>
        save_as_text<span class="token punctuation">(</span>content<span class="token punctuation">,</span> output_name<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># pdf, gif, png, jpeg</span>
        content_array <span class="token operator">=</span> content<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content_array<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> OSError<span class="token punctuation">(</span>content_array<span class="token punctuation">)</span>

        image_data <span class="token operator">=</span> decode_base64<span class="token punctuation">(</span>content_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> file_type <span class="token keyword">in</span> <span class="token punctuation">[</span>PDF_FORMAT<span class="token punctuation">,</span> GIF_FORMAT<span class="token punctuation">,</span> EPS_FORMAT<span class="token punctuation">]</span><span class="token punctuation">:</span>
            save_as<span class="token punctuation">(</span>image_data<span class="token punctuation">,</span> output_name<span class="token punctuation">,</span> file_type<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> file_type <span class="token keyword">in</span> <span class="token punctuation">[</span>PNG_FORMAT<span class="token punctuation">,</span> JPG_FORMAT<span class="token punctuation">]</span><span class="token punctuation">:</span>
            save_as_png<span class="token punctuation">(</span>image_data<span class="token punctuation">,</span> output_name<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">&quot;Not supported file type '%s'&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>file_type<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token string">&quot;/&quot;</span> <span class="token keyword">not</span> <span class="token keyword">in</span> output_name<span class="token punctuation">:</span>
        output_name <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> output_name<span class="token punctuation">)</span>

    <span class="token keyword">if</span> is_remove_html <span class="token keyword">and</span> <span class="token keyword">not</span> file_name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>unlink<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;File saved in %s&quot;</span> <span class="token operator">%</span> output_name<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">make_snapshot_in_memory</span><span class="token punctuation">(</span>
        engine<span class="token punctuation">,</span>
        file_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
        delay<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
        pixel_ratio<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
        is_remove_html<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
        <span class="token operator">**</span>kwargs<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;Generating file ...&quot;</span><span class="token punctuation">)</span>
    file_type <span class="token operator">=</span> <span class="token string">&quot;png&quot;</span>

    content <span class="token operator">=</span> engine<span class="token punctuation">.</span>make_snapshot<span class="token punctuation">(</span>
        html_path<span class="token operator">=</span>file_name<span class="token punctuation">,</span>
        file_type<span class="token operator">=</span>file_type<span class="token punctuation">,</span>
        delay<span class="token operator">=</span>delay<span class="token punctuation">,</span>
        pixel_ratio<span class="token operator">=</span>pixel_ratio<span class="token punctuation">,</span>
        <span class="token operator">**</span>kwargs<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    content_array <span class="token operator">=</span> content<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content_array<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> OSError<span class="token punctuation">(</span>content_array<span class="token punctuation">)</span>

    image_data <span class="token operator">=</span> decode_base64<span class="token punctuation">(</span>content_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> is_remove_html <span class="token keyword">and</span> <span class="token keyword">not</span> file_name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>unlink<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>

    m <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span>image_data<span class="token punctuation">)</span>
    m<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> m


<span class="token keyword">def</span> <span class="token function">decode_base64</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Decode base64, padding being optional.

    :param data: Base64 data as an ASCII byte string
    :returns: The decoded byte string.
    &quot;&quot;&quot;</span>
    missing_padding <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span>
    <span class="token keyword">if</span> missing_padding <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        data <span class="token operator">+=</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">-</span> missing_padding<span class="token punctuation">)</span>
    <span class="token keyword">return</span> base64<span class="token punctuation">.</span>decodebytes<span class="token punctuation">(</span>data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">save_as_png</span><span class="token punctuation">(</span>image_data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> output_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_name<span class="token punctuation">,</span> <span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>image_data<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">save_as_text</span><span class="token punctuation">(</span>image_data<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> output_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> codecs<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>output_name<span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>image_data<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">save_as</span><span class="token punctuation">(</span>image_data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> output_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> file_type<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image

        m <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>image_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
        m<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span>
        color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
        b <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">&quot;RGB&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>size<span class="token punctuation">,</span> color<span class="token punctuation">)</span>
        b<span class="token punctuation">.</span>paste<span class="token punctuation">(</span>m<span class="token punctuation">,</span> mask<span class="token operator">=</span>m<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        b<span class="token punctuation">.</span>save<span class="token punctuation">(</span>output_name<span class="token punctuation">,</span> file_type<span class="token punctuation">,</span> quality<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> ModuleNotFoundError<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">&quot;Please install PIL for {} image type&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>file_type<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># generate.py</span>
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>styles <span class="token keyword">import</span> getSampleStyleSheet<span class="token punctuation">,</span> ParagraphStyle
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>pagesizes <span class="token keyword">import</span> A4<span class="token punctuation">,</span> landscape<span class="token punctuation">,</span> portrait
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>platypus <span class="token keyword">import</span> SimpleDocTemplate<span class="token punctuation">,</span> Paragraph<span class="token punctuation">,</span> Spacer<span class="token punctuation">,</span> Image<span class="token punctuation">,</span> Table<span class="token punctuation">,</span> TableStyle<span class="token punctuation">,</span> Frame<span class="token punctuation">,</span> ListFlowable<span class="token punctuation">,</span> ListItem<span class="token punctuation">,</span> PageBreak
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>pdfbase <span class="token keyword">import</span> pdfmetrics
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>pdfbase<span class="token punctuation">.</span>ttfonts <span class="token keyword">import</span> TTFont
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>enums <span class="token keyword">import</span> TA_JUSTIFY<span class="token punctuation">,</span> TA_CENTER
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib <span class="token keyword">import</span> colors
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>colors <span class="token keyword">import</span> CMYKColor
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>units <span class="token keyword">import</span> inch<span class="token punctuation">,</span> mm
<span class="token keyword">import</span> shutil
<span class="token keyword">import</span> os
<span class="token keyword">from</span> pages <span class="token keyword">import</span> summary<span class="token punctuation">,</span> detail<span class="token punctuation">,</span> miss<span class="token punctuation">,</span> testInfo<span class="token punctuation">,</span> peertest<span class="token punctuation">,</span> overall<span class="token punctuation">,</span> dashboard
<span class="token keyword">from</span> utils <span class="token keyword">import</span> timer

<span class="token comment"># 设置中文字体</span>
pdfmetrics<span class="token punctuation">.</span>registerFont<span class="token punctuation">(</span>TTFont<span class="token punctuation">(</span><span class="token string">'SimSun'</span><span class="token punctuation">,</span> <span class="token string">'./Fonts/SimSun.ttf'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 设置样式</span>
styles <span class="token operator">=</span> getSampleStyleSheet<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># header</span>
styles<span class="token punctuation">.</span>add<span class="token punctuation">(</span>ParagraphStyle<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'header'</span><span class="token punctuation">,</span> leftIndent<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> rightIndent<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> 
leading<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> alignment<span class="token operator">=</span>TA_JUSTIFY<span class="token punctuation">,</span> fontName<span class="token operator">=</span><span class="token string">&quot;SimSun&quot;</span><span class="token punctuation">,</span> fontWeight<span class="token operator">=</span><span class="token string">&quot;bold&quot;</span><span class="token punctuation">,</span> lineHeight<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span> fontSize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> textColor<span class="token operator">=</span><span class="token string">'#003153'</span><span class="token punctuation">,</span> bulletFontSize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> bulletIndent<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> bulletAnchor<span class="token operator">=</span><span class="token string">'start'</span><span class="token punctuation">,</span> bulletFontName<span class="token operator">=</span><span class="token string">'Symbol'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 大写标题</span>
styles<span class="token punctuation">.</span>add<span class="token punctuation">(</span>ParagraphStyle<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'bigTitle'</span><span class="token punctuation">,</span> leftIndent<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> rightIndent<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> 
leading<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> alignment<span class="token operator">=</span>TA_JUSTIFY<span class="token punctuation">,</span> fontName<span class="token operator">=</span><span class="token string">&quot;SimSun&quot;</span><span class="token punctuation">,</span> fontWeight<span class="token operator">=</span><span class="token string">&quot;bold&quot;</span><span class="token punctuation">,</span> lineHeight<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span> fontSize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> textColor<span class="token operator">=</span><span class="token string">'#003153'</span><span class="token punctuation">,</span> bulletFontSize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> bulletIndent<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> bulletAnchor<span class="token operator">=</span><span class="token string">'start'</span><span class="token punctuation">,</span> bulletFontName<span class="token operator">=</span><span class="token string">'Symbol'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 正文</span>
styles<span class="token punctuation">.</span>add<span class="token punctuation">(</span>ParagraphStyle<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'txt'</span><span class="token punctuation">,</span> leftIndent<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> rightIndent<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> alignment<span class="token operator">=</span>TA_JUSTIFY<span class="token punctuation">,</span> fontName<span class="token operator">=</span><span class="token string">&quot;SimSun&quot;</span><span class="token punctuation">,</span> fontSize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> lineHeight<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span> textColor<span class="token operator">=</span><span class="token string">'#003153'</span><span class="token punctuation">,</span> bulletFontSize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> bulletIndent<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> bulletAnchor<span class="token operator">=</span><span class="token string">'start'</span><span class="token punctuation">,</span> bulletFontName<span class="token operator">=</span><span class="token string">'Symbol'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Generator</span><span class="token punctuation">:</span>
  story <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  totalData <span class="token operator">=</span> <span class="token boolean">None</span>
  pages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment"># a4纸的尺寸[210cm / 8.27 inch, 297cm / 11.69inch]</span>
  PAGE_WIDTH <span class="token operator">=</span> <span class="token number">297</span> <span class="token operator">*</span> mm
  PAGE_HEIGHT <span class="token operator">=</span> <span class="token number">210</span> <span class="token operator">*</span> mm
  <span class="token comment"># 公用</span>
  logo <span class="token operator">=</span> <span class="token string">'./data/logo_big.png'</span>
  company_logo <span class="token operator">=</span> <span class="token string">''</span>

  <span class="token comment"># 外部调用，根据数据渲染生成pdf文件</span>
  <span class="token decorator annotation punctuation">@timer</span>
  <span class="token keyword">def</span> <span class="token function">generatePdf</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pagesData<span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token comment"># 初始化</span>
      self<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment"># 格式化</span>
      self<span class="token punctuation">.</span>totalData <span class="token operator">=</span> pagesData
      self<span class="token punctuation">.</span>pages <span class="token operator">=</span> self<span class="token punctuation">.</span>formatPages<span class="token punctuation">(</span>pagesData<span class="token punctuation">[</span><span class="token string">'pages'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>company_logo <span class="token operator">=</span> pagesData<span class="token punctuation">[</span><span class="token string">'company'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'logo'</span><span class="token punctuation">]</span>

      <span class="token comment"># 遍历页面，根据页面类型插入内容</span>
      <span class="token comment"># for i in range(20):</span>
      <span class="token keyword">for</span> page <span class="token keyword">in</span> self<span class="token punctuation">.</span>pages<span class="token punctuation">:</span>
          self<span class="token punctuation">.</span>renderPage<span class="token punctuation">(</span>page<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>

      <span class="token comment"># 已存在文件先删除</span>
      reportName <span class="token operator">=</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.pdf'</span>
      <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>reportName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
          os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>reportName<span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token comment"># 生成文件，自动按照横向A4大小分页</span>
      doc <span class="token operator">=</span> SimpleDocTemplate<span class="token punctuation">(</span>reportName<span class="token punctuation">,</span> pagesize<span class="token operator">=</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>PAGE_WIDTH<span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">,</span> leftMargin<span class="token operator">=</span><span class="token number">0.5</span><span class="token operator">*</span>inch<span class="token punctuation">,</span> rightMargin<span class="token operator">=</span><span class="token number">0.5</span><span class="token operator">*</span>inch<span class="token punctuation">)</span>
      doc<span class="token punctuation">.</span>multiBuild<span class="token punctuation">(</span>self<span class="token punctuation">.</span>story<span class="token punctuation">,</span> onFirstPage<span class="token operator">=</span>self<span class="token punctuation">.</span>myFirstPage<span class="token punctuation">,</span> onLaterPages<span class="token operator">=</span>self<span class="token punctuation">.</span>myLaterPages<span class="token punctuation">)</span>

  <span class="token comment"># 初始化数据</span>
  <span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
      self<span class="token punctuation">.</span>story <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      self<span class="token punctuation">.</span>pages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      self<span class="token punctuation">.</span>totalData <span class="token operator">=</span> <span class="token boolean">None</span>
      <span class="token comment"># 清理img文件夹</span>
      imgPath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'img/'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span>
      <span class="token keyword">else</span><span class="token punctuation">:</span>
        shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span>
        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span>

  <span class="token comment"># 处理个别页面是个数组而非对象</span>
  <span class="token keyword">def</span> <span class="token function">formatPages</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> rawPages<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">for</span> page <span class="token keyword">in</span> rawPages<span class="token punctuation">:</span>
          <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__ <span class="token operator">==</span> <span class="token string">'list'</span><span class="token punctuation">:</span>
              <span class="token keyword">for</span> item <span class="token keyword">in</span> page<span class="token punctuation">:</span>
                  <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
          <span class="token keyword">else</span><span class="token punctuation">:</span>
              <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>page<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token builtin">list</span>

  <span class="token comment"># 首页钩子，插入页眉页脚</span>
  <span class="token keyword">def</span> <span class="token function">myFirstPage</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
      canvas<span class="token punctuation">.</span>saveState<span class="token punctuation">(</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>renderHeader<span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>renderFooter<span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span>
      canvas<span class="token punctuation">.</span>restoreState<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment"># 其他页面钩子，插入页眉页脚</span>
  <span class="token keyword">def</span> <span class="token function">myLaterPages</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
      canvas<span class="token punctuation">.</span>saveState<span class="token punctuation">(</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>renderHeader<span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>renderFooter<span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span>
      canvas<span class="token punctuation">.</span>restoreState<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment"># 渲染页眉</span>
  <span class="token keyword">def</span> <span class="token function">renderHeader</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
      padding <span class="token operator">=</span> <span class="token number">10</span>
      <span class="token comment"># Logo</span>
      logo_width <span class="token operator">=</span> <span class="token number">127</span>
      logo_height <span class="token operator">=</span> <span class="token number">50</span>
      canvas<span class="token punctuation">.</span>drawImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>logo<span class="token punctuation">,</span> padding<span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_HEIGHT <span class="token operator">-</span> logo_height <span class="token operator">-</span> padding<span class="token punctuation">,</span> width<span class="token operator">=</span>logo_width<span class="token punctuation">,</span> height<span class="token operator">=</span>logo_height<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token string">'auto'</span><span class="token punctuation">)</span>
      <span class="token comment"># Title</span>
      canvas<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span><span class="token string">'Times-Bold'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
      canvas<span class="token punctuation">.</span>drawCentredString<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PAGE_WIDTH <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_HEIGHT <span class="token operator">-</span> padding <span class="token operator">-</span> <span class="token number">24</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">[</span><span class="token string">'subtitle'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        canvas<span class="token punctuation">.</span>drawCentredString<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PAGE_WIDTH <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_HEIGHT <span class="token operator">-</span> padding <span class="token operator">-</span> <span class="token number">24</span> <span class="token operator">-</span> <span class="token number">24</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">[</span><span class="token string">'subtitle'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment"># Company Logo</span>
      company_logo_width <span class="token operator">=</span> <span class="token number">50</span>
      company_logo_height <span class="token operator">=</span> <span class="token number">50</span>
      canvas<span class="token punctuation">.</span>drawImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>company_logo<span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_WIDTH <span class="token operator">-</span> company_logo_width <span class="token operator">-</span> padding<span class="token punctuation">,</span> self<span class="token punctuation">.</span>PAGE_HEIGHT <span class="token operator">-</span> company_logo_height <span class="token operator">-</span> padding<span class="token punctuation">,</span> width<span class="token operator">=</span>company_logo_width<span class="token punctuation">,</span> height<span class="token operator">=</span>company_logo_height<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token string">'auto'</span><span class="token punctuation">)</span>

  <span class="token comment"># 渲染页脚</span>
  <span class="token keyword">def</span> <span class="token function">renderFooter</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> canvas<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
      padding <span class="token operator">=</span> <span class="token number">20</span>
      canvas<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span><span class="token string">'Times-Roman'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
      canvas<span class="token punctuation">.</span>drawCentredString<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PAGE_WIDTH <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token punctuation">,</span> <span class="token string">&quot;%s&quot;</span> <span class="token operator">%</span> doc<span class="token punctuation">.</span>page<span class="token punctuation">)</span>

  <span class="token comment"># 渲染页面内容</span>
  <span class="token comment"># @timer</span>
  <span class="token keyword">def</span> <span class="token function">renderPage</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> page<span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">:</span>
      pageType <span class="token operator">=</span> page<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span>

      <span class="token comment"># analysis</span>
      <span class="token keyword">if</span> pageType <span class="token operator">==</span> <span class="token string">'summary'</span><span class="token punctuation">:</span>
          summary<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>self<span class="token punctuation">.</span>story<span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">,</span> page<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>
      <span class="token keyword">elif</span> pageType <span class="token operator">==</span> <span class="token string">'detail'</span><span class="token punctuation">:</span>
          testInfo<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>self<span class="token punctuation">.</span>story<span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">,</span> page<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>
          detail<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>self<span class="token punctuation">.</span>story<span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">,</span> page<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>
      <span class="token keyword">elif</span> pageType <span class="token operator">==</span> <span class="token string">'miss'</span><span class="token punctuation">:</span>
          testInfo<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>self<span class="token punctuation">.</span>story<span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">,</span> page<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>
          miss<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>self<span class="token punctuation">.</span>story<span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">,</span> page<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>

      <span class="token comment"># peertest</span>
      <span class="token keyword">elif</span> pageType <span class="token operator">==</span> <span class="token string">'peertest'</span><span class="token punctuation">:</span>
          peertest<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>self<span class="token punctuation">.</span>story<span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">,</span> page<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>

      <span class="token comment"># dashboard</span>
      <span class="token keyword">elif</span> pageType <span class="token operator">==</span> <span class="token string">'overall'</span><span class="token punctuation">:</span>
        overall<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>self<span class="token punctuation">.</span>story<span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">,</span> page<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>
      <span class="token keyword">elif</span> pageType <span class="token operator">==</span> <span class="token string">'dashboard'</span><span class="token punctuation">:</span>
        dashboard<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>self<span class="token punctuation">.</span>story<span class="token punctuation">,</span> self<span class="token punctuation">.</span>totalData<span class="token punctuation">,</span> page<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>

      <span class="token comment"># others</span>
      <span class="token keyword">else</span><span class="token punctuation">:</span>
          <span class="token keyword">pass</span>

      <span class="token comment"># 分页</span>
      self<span class="token punctuation">.</span>story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>PageBreak<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>components为封装的图表组件。</p> <div class="language-python extra-class"><pre class="language-python"><code>myBar<span class="token punctuation">.</span>py
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>platypus <span class="token keyword">import</span> Image
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>units <span class="token keyword">import</span> cm
<span class="token keyword">import</span> pyecharts
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> Bar
<span class="token keyword">from</span> pyecharts <span class="token keyword">import</span> options <span class="token keyword">as</span> opts
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span><span class="token builtin">globals</span> <span class="token keyword">import</span> ThemeType
<span class="token keyword">import</span> uuid
<span class="token keyword">from</span> utils <span class="token keyword">import</span> timer<span class="token punctuation">,</span> snap_shot

<span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># 默认900*500</span>
    bar <span class="token operator">=</span> Bar<span class="token punctuation">(</span>init_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>InitOpts<span class="token punctuation">(</span>theme<span class="token operator">=</span>ThemeType<span class="token punctuation">.</span>MACARONS<span class="token punctuation">,</span>animation_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AnimationOpts<span class="token punctuation">(</span>animation<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    x_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        x_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
    bar<span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>x_list<span class="token punctuation">)</span>

    <span class="token keyword">for</span> y_key <span class="token keyword">in</span> y<span class="token punctuation">:</span>
        y_item <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
            y_item<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">[</span>y_key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        bar<span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span>y_key<span class="token punctuation">,</span> y_item<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> bar

<span class="token keyword">def</span> <span class="token function">drawImg</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    bar <span class="token operator">=</span> draw<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> data<span class="token punctuation">)</span>

    name <span class="token operator">=</span> uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span>
    img <span class="token operator">=</span> snap_shot<span class="token punctuation">(</span>bar<span class="token punctuation">,</span> name<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>drawHeight <span class="token operator">=</span> <span class="token number">7</span><span class="token operator">*</span>cm  <span class="token comment"># 设置读取后图片的高</span>
    img<span class="token punctuation">.</span>drawWidth <span class="token operator">=</span> <span class="token number">13</span><span class="token operator">*</span>cm  <span class="token comment"># 设置读取后图片的宽</span>

    <span class="token keyword">return</span> img
</code></pre></div><p>pages为具体某一类型报告页面的代码。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># detail.py</span>
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>styles <span class="token keyword">import</span> getSampleStyleSheet<span class="token punctuation">,</span> ParagraphStyle
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>platypus <span class="token keyword">import</span> SimpleDocTemplate<span class="token punctuation">,</span> Paragraph<span class="token punctuation">,</span> Spacer<span class="token punctuation">,</span> Image<span class="token punctuation">,</span> Table<span class="token punctuation">,</span> TableStyle<span class="token punctuation">,</span> Frame<span class="token punctuation">,</span> ListFlowable<span class="token punctuation">,</span> ListItem
<span class="token keyword">from</span> reportlab<span class="token punctuation">.</span>lib <span class="token keyword">import</span> colors
<span class="token keyword">from</span> components <span class="token keyword">import</span> myTable<span class="token punctuation">,</span> myBar
<span class="token keyword">from</span> decimal <span class="token keyword">import</span> <span class="token operator">*</span>


<span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>story<span class="token punctuation">,</span> totalData<span class="token punctuation">,</span> page<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 图表标题</span>
    t1 <span class="token operator">=</span> Paragraph<span class="token punctuation">(</span>page<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> styles<span class="token punctuation">[</span><span class="token string">'header'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t1<span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> Paragraph<span class="token punctuation">(</span><span class="token string">'By:'</span> <span class="token operator">+</span> page<span class="token punctuation">[</span><span class="token string">'by'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> styles<span class="token punctuation">[</span><span class="token string">'header'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t2<span class="token punctuation">)</span>

    story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Spacer<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 柱形图</span>
    <span class="token keyword">if</span> page<span class="token punctuation">[</span><span class="token string">'chart'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> page<span class="token punctuation">[</span><span class="token string">'chart'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
      bar_x <span class="token operator">=</span> page<span class="token punctuation">[</span><span class="token string">'chart'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span>
      bar_y <span class="token operator">=</span> page<span class="token punctuation">[</span><span class="token string">'chart'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span>
      bar_data <span class="token operator">=</span> page<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span>
      story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>myBar<span class="token punctuation">.</span>drawImg<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> bar_x<span class="token punctuation">,</span> bar_y<span class="token punctuation">,</span> bar_data<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 数据表格</span>
    table_cols <span class="token operator">=</span> page<span class="token punctuation">[</span><span class="token string">'th'</span><span class="token punctuation">]</span>
    table_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> page<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        rowData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> col <span class="token keyword">in</span> table_cols<span class="token punctuation">:</span>
            rowData<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span>
        table_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rowData<span class="token punctuation">)</span>
    story<span class="token punctuation">.</span>append<span class="token punctuation">(</span>myTable<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>table_cols<span class="token punctuation">,</span> table_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/1/2020, 12:21:05 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.df436686.js" defer></script><script src="/assets/js/11.05267775.js" defer></script>
  </body>
</html>
