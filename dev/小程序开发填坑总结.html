<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小程序开发填坑总结 | 王昊的个人博客</title>
    <meta name="description" content="前端">
    
    
    <link rel="preload" href="/assets/css/0.styles.7f50033a.css" as="style"><link rel="preload" href="/assets/js/app.df436686.js" as="script"><link rel="preload" href="/assets/js/21.3e37a615.js" as="script"><link rel="prefetch" href="/assets/js/10.8434dcff.js"><link rel="prefetch" href="/assets/js/11.05267775.js"><link rel="prefetch" href="/assets/js/12.df6d9c5b.js"><link rel="prefetch" href="/assets/js/13.21976a23.js"><link rel="prefetch" href="/assets/js/14.adeb946a.js"><link rel="prefetch" href="/assets/js/15.05695498.js"><link rel="prefetch" href="/assets/js/16.25b6b60c.js"><link rel="prefetch" href="/assets/js/17.29da1f0d.js"><link rel="prefetch" href="/assets/js/18.d5ac0d11.js"><link rel="prefetch" href="/assets/js/19.d33bd39b.js"><link rel="prefetch" href="/assets/js/2.bd311f47.js"><link rel="prefetch" href="/assets/js/20.1a54c413.js"><link rel="prefetch" href="/assets/js/22.f9b638cf.js"><link rel="prefetch" href="/assets/js/23.3b83adb9.js"><link rel="prefetch" href="/assets/js/3.d1de4629.js"><link rel="prefetch" href="/assets/js/4.102c42f8.js"><link rel="prefetch" href="/assets/js/5.64c0317a.js"><link rel="prefetch" href="/assets/js/6.f0ab4840.js"><link rel="prefetch" href="/assets/js/7.37b04fc2.js"><link rel="prefetch" href="/assets/js/8.02e51ca2.js"><link rel="prefetch" href="/assets/js/9.321af1f8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7f50033a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">王昊的个人博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">资源</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.iconfont.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里巴巴图标库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://apizza.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Apizza
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.codewars.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Codewars
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://leetcode-cn.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.ruanyifeng.com/home.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阮一峰
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.zhangxinxu.com/wordpress/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  张鑫旭
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  廖雪峰
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">资源</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.iconfont.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里巴巴图标库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://apizza.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Apizza
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.codewars.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Codewars
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://leetcode-cn.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.ruanyifeng.com/home.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阮一峰
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.zhangxinxu.com/wordpress/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  张鑫旭
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  廖雪峰
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/dev/小程序开发填坑总结.html" class="active sidebar-link">小程序开发填坑总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#架构" class="sidebar-link">架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#目录结构" class="sidebar-link">目录结构</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#ajax库" class="sidebar-link">ajax库</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#状态管理" class="sidebar-link">状态管理</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#eslint" class="sidebar-link">Eslint</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#fundebug" class="sidebar-link">fundebug</a></li></ul></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#填坑" class="sidebar-link">填坑</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#页面生命周期" class="sidebar-link">页面生命周期</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#data初始化问题" class="sidebar-link">data初始化问题</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#setdata异步问题" class="sidebar-link">setData异步问题</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#分享与url传值截断" class="sidebar-link">分享与URL传值截断</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#wxs使用" class="sidebar-link">wxs使用</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#wxs报错" class="sidebar-link">wxs报错</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#scroll-view与overflow-auto" class="sidebar-link">scroll-view与overflow: auto</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#textarea组件层级" class="sidebar-link">textarea组件层级</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#富文本解析及内存" class="sidebar-link">富文本解析及内存</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#富文本图片大小" class="sidebar-link">富文本图片大小</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#组件传值" class="sidebar-link">组件传值</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#组件slot渲染错误" class="sidebar-link">组件slot渲染错误</a></li><li class="sidebar-sub-header"><a href="/dev/小程序开发填坑总结.html#第三方授权客服和模板消息" class="sidebar-link">第三方授权客服和模板消息</a></li></ul></li></ul></li><li><a href="/dev/公众号h5自定义分享.html" class="sidebar-link">公众号h5自定义分享</a></li><li><a href="/dev/小程序使用async和await.html" class="sidebar-link">在小程序中使用async/await</a></li><li><a href="/dev/chrome插件开发.html" class="sidebar-link">chrome插件开发</a></li><li><a href="/dev/rollup使用.html" class="sidebar-link">rollup使用教程</a></li><li><a href="/dev/jsPdf生成pdf.html" class="sidebar-link">jspdf生成Pdf文档</a></li><li><a href="/dev/vue的provide和inject方法.html" class="sidebar-link">vue的provide和inject方法</a></li><li><a href="/dev/vue刷新页面.html" class="sidebar-link">vue刷新页面</a></li><li><a href="/dev/vue-cli项目的环境编译.html" class="sidebar-link">vue-cli项目的环境编译</a></li><li><a href="/dev/nvm版本管理.html" class="sidebar-link">nvm版本管理</a></li><li><a href="/dev/npm源管理.html" class="sidebar-link">npm源管理</a></li><li><a href="/dev/外卖小程序首页商品列表和购物车的优化.html" class="sidebar-link">外卖小程序首页商品列表和购物车的优化</a></li><li><a href="/dev/svg的响应式.html" class="sidebar-link">svg的响应式</a></li><li><a href="/dev/python生成pdf报告.html" class="sidebar-link">python生成pdf报告</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="小程序开发填坑总结"><a href="#小程序开发填坑总结" class="header-anchor">#</a> 小程序开发填坑总结</h1> <p>最近新公司接手一个题库小程序，也是我第一个小程序项目，属于一期升二期改版。</p> <h2 id="架构"><a href="#架构" class="header-anchor">#</a> 架构</h2> <p>首先对原项目结构进行了优化，将配置文件、常量等从util文件夹提出，对所有ajax请求放到api文件夹统一管理，引入状态管理器，引入eslint配置。由于是第一个小程序，暂未使用第三方框架，下次从零开始写新项目考虑使用<a href="http://mpvue.com/" target="_blank" rel="noopener noreferrer">mpvue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或者<a href="https://tencent.github.io/wepy/" target="_blank" rel="noopener noreferrer">wepy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="目录结构"><a href="#目录结构" class="header-anchor">#</a> 目录结构</h3> <img src="/img/题库小程序目录结构.png" alt> <h3 id="ajax库"><a href="#ajax库" class="header-anchor">#</a> ajax库</h3> <p>由于小程序没有dom的概念，axios在小程序中无法使用。找到一款<a href="https://github.com/wendux/fly" target="_blank" rel="noopener noreferrer">fly.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，全面支持浏览器、小程序、node。RN等多种环境，用法类似axios，可以设置拦截器等。</p> <p>直接把wx.umd.min.js文件放到lib目录，在api/index.js中引入。使用如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> host<span class="token punctuation">,</span> app<span class="token punctuation">,</span> version <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../config/index.js'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Fly <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../libs/flyio/wx.umd.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fly <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置请求基地址</span>
fly<span class="token punctuation">.</span>config<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> host<span class="token punctuation">;</span>
fly<span class="token punctuation">.</span>config<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
<span class="token comment">// 添加拦截器</span>
<span class="token comment">/**
request: {
  baseURL,  //请求的基地址
  body, //请求的参数
  headers, //自定义的请求头
  method, // 请求方法
  timeout, //本次请求的超时时间
  url, // 本次请求的地址
  withCredentials //跨域请求是否发送第三方cookie
}
**/</span>
fly<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token parameter">request</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// post传参用formdata</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/x-www-form-urlencoded '</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 检查token</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> token <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fly<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// do sth</span>
      fly<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> request<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> request<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
response: {
  data, //服务器返回的数据
  engine, //请求使用的http engine(见下面文档),浏览器中为本次请求的XMLHttpRequest对象
  headers, //响应头信息
  request  //本次响应对应的请求信息
}
**/</span>
fly<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 处理返回码</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 处理错误</span>
    <span class="token keyword">return</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 业务接口</span>

<span class="token comment">/** ******************* 登陆 *****************/</span>
<span class="token comment">// 获取登录状态</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">checkLoginStatus</span> <span class="token operator">=</span> <span class="token parameter">params</span> <span class="token operator">=&gt;</span> fly<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/sso/checkLogin.html'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取免费资料保存微信</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getFreeCourse</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> fly<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/getFreeCourse.html'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
</code></pre></div><h3 id="状态管理"><a href="#状态管理" class="header-anchor">#</a> 状态管理</h3> <p>网上多使用redux和mobx，mpvue可直接使用vuex。相比redux的繁琐，mobx更适合小程序。找到一款基于mobx的第三方库<a href="https://github.com/80percent/wechat-weapp-mobx" target="_blank" rel="noopener noreferrer">wechat-weapp-mobx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>mobx可创建多个store，在store目录中建立各个store文件。由于小程序是多页面，页面跳转时，需要将状态存储到全局，可以使用app.js的globalData。</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">onLaunch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  globalData<span class="token operator">:</span> <span class="token punctuation">{</span>
    stores<span class="token operator">:</span> <span class="token punctuation">{</span>
      userStore<span class="token punctuation">,</span>
      homeStore<span class="token punctuation">,</span>
      cartStore<span class="token punctuation">,</span>
      topicStore<span class="token punctuation">,</span>
      courseStore<span class="token punctuation">,</span>
      openCourseStore<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>store文件编写如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 用户中心
 */</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> api <span class="token keyword">from</span> <span class="token string">'../api/index'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> mobx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../libs/mobx/mobx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> extendObservable <span class="token operator">=</span> mobx<span class="token punctuation">.</span>extendObservable<span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">UserStore</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">/** data **/</span>
    key<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>

    <span class="token comment">/** 计算属性 **/</span>
    <span class="token keyword">get</span> <span class="token function">xxx</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'xxx'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/** action **/</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">showLoginModal</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isLoginModalShow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> api<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在页面引入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../libs/mobx/observer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>observer<span class="token punctuation">;</span>
<span class="token keyword">const</span> globalData <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">;</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    homeStore<span class="token operator">:</span> globalData<span class="token punctuation">.</span>stores<span class="token punctuation">.</span>homeStore<span class="token punctuation">,</span>
    userStore<span class="token operator">:</span> globalData<span class="token punctuation">.</span>stores<span class="token punctuation">.</span>userStore<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onShow</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>发现对于深层属性，在赋值时设置过的就会动态监听，而直接在对象添加属性则不会触发刷新。</p> <p>在action中返回promise对象，在js中调用并执行then函数，发现get计算属性先执行，then中可以拿到计算后的结果。</p> <h3 id="eslint"><a href="#eslint" class="header-anchor">#</a> Eslint</h3> <p>习惯使用<a href="http://eslint.cn/" target="_blank" rel="noopener noreferrer">eslint<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>对项目进行格式校验，配合prettier自动格式对齐。</p> <p>在根目录创建package.json文件，安装相关库：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev eslint babel babel-eslint eslint-config-standard eslint-plugin-import eslint-plugin-node eslint-plugin-promise eslint-plugin-standard
</code></pre></div><p>新建.eslintrc.js文件添加常用规则，在globals中设置小程序全局变量：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  root<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  env<span class="token operator">:</span> <span class="token punctuation">{</span>
    node<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'standard'</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  rules<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'semi'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'always'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'no-console'</span><span class="token operator">:</span> <span class="token string">'off'</span><span class="token punctuation">,</span>
    <span class="token string">'no-debugger'</span><span class="token operator">:</span> <span class="token string">'off'</span><span class="token punctuation">,</span>
    <span class="token string">&quot;comma-dangle&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;always-multiline&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;indent&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'prefer-promise-reject-errors'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  parserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    parser<span class="token operator">:</span> <span class="token string">'babel-eslint'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  globals<span class="token operator">:</span> <span class="token punctuation">{</span>
    wx<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    App<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    Page<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    getApp<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    Component<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    getCurrentPages<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>新建.eslintignore和.gitignore文件。</p> <h3 id="fundebug"><a href="#fundebug" class="header-anchor">#</a> fundebug</h3> <p>在<a href="https://www.fundebug.com" target="_blank" rel="noopener noreferrer">fundebug官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>创建项目，在app.js引入fundebug并初始化。这样项目运行过程中发生的接口错误都能在fundebug控制台查看详细情况，便于分析错误。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fundebug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./libs/fundebug.0.8.2.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fundebug<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  apikey<span class="token operator">:</span> <span class="token string">'xxxxxxx'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="填坑"><a href="#填坑" class="header-anchor">#</a> 填坑</h2> <h3 id="页面生命周期"><a href="#页面生命周期" class="header-anchor">#</a> 页面生命周期</h3> <p>onLoad在页面加载时执行，onShow在页面显示时执行。开始以为onShow就是对应小程序后台切前台，后来发现在页面加载阶段也会执行，在页面后退时也会执行。</p> <p>小程序页面可以存在5层。通过redirectTo跳转时，页面销毁并创建新页面。而通过navigateTo跳转时，页面并未销毁，而是在下一层打开新页面。当点击后退时，下一层页面销毁并后退到上一层，此时触发onShow事件。</p> <p>另外页面加载时onLoad和onShow都后执行，onShow无法拿到onLoad的参数，如果onLoad中setData，onShow从data取值不能一定取到。最好是设置一个flag，当第一次登陆时，从onLoad执行相关函数；onShow判断第一次执行修改flag，以后执行相关函数。</p> <p>在开发者工具的AppData中可以清楚地看到页面结构：</p> <img src="/img/题库小程序页面分级.png" alt> <h3 id="data初始化问题"><a href="#data初始化问题" class="header-anchor">#</a> data初始化问题</h3> <p>小程序初始化页面时，data中直接使用globalData[key]，当对应值在app.js中设置时可正常获取，当这个值是在其他页面设置的时，得到null。data中使用wx.getStorageSync取值同样得到null。所以应当在onload中设置data项的值。</p> <h3 id="setdata异步问题"><a href="#setdata异步问题" class="header-anchor">#</a> setData异步问题</h3> <p>文档中说setData是异步函数，实际改变数值是同步的，渲染页面是异步的。</p> <h3 id="分享与url传值截断"><a href="#分享与url传值截断" class="header-anchor">#</a> 分享与URL传值截断</h3> <p>小程序的分享默认分享当前页面，但是分享后对方进入无法后退。网上存在两种办法，一是在分享页面增加一个回到首页的按钮，二是分享页面先到首页再跳转到分享页。</p> <p>这里我采取了第二种方法，分享方法如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">onShareAppMessage</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/pages/home/index?target=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>然后发现存在一个问题，就是对于带参数的页面，参数没有带过去。然后增加参数：</p> <div class="language-js extra-class"><pre class="language-js"><code>url <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">'?'</span> <span class="token operator">+</span> <span class="token string">'key=value'</span>
</code></pre></div><p>发现依然没有接收到参数，原来是index后面的?和url中的?，存在两个?，而拿到的options到第二个?就截断了。</p> <p>最终分享如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">onShareAppMessage</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/pages/home/index?target=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;targetOptions=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span>options<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="wxs使用"><a href="#wxs使用" class="header-anchor">#</a> wxs使用</h3> <p>wxml模板不支持引用js中的函数，但是可以通过使用<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxs/" target="_blank" rel="noopener noreferrer">wxs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来达到同样的效果。</p> <p>wxs文件：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">fix2</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> num<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>在wxml中引用：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wxs</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./oldExamList.wxs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">module</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>m1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wxs</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>￥{{m1.fix2(item.price)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="wxs报错"><a href="#wxs报错" class="header-anchor">#</a> wxs报错</h3> <p>wxs并非完全的js环境，要注意和js的区别。wxs的报错不可见，这个比较坑。如果小程序突然编译错误，页面完全空白，注意wxs，即便不引入wxs文件也不行。</p> <ul><li>在使用wxs的过程中，遇到日期解析的问题。查阅官方文档，小程序支持Date.now()和Date.parse()方法，但是一直解析失败，后来发现是日期格式的问题，在ios设备上不支持xxxx-xx-xx这样的格式，转换为/后正常。</li> <li>在wxs中不能使用es6，即使模拟器开启es6转换也没用。</li> <li>在wxs中，遇到for循环中第一个条件声明多个变量报错。</li></ul> <h3 id="scroll-view与overflow-auto"><a href="#scroll-view与overflow-auto" class="header-anchor">#</a> scroll-view与overflow: auto</h3> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/component/scroll-view.html" target="_blank" rel="noopener noreferrer">scroll-view<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>除了有一些事件之外，还能够惯性滚动，而overflow: auto则不具有惯性。未测试overflow: auto加-webkit-overflow-scrolling:touch与scroll-view对比。</p> <h3 id="textarea组件层级"><a href="#textarea组件层级" class="header-anchor">#</a> textarea组件层级</h3> <p>小程序中<a href="https://developers.weixin.qq.com/miniprogram/dev/component/textarea.html" target="_blank" rel="noopener noreferrer">textarea<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>属于原生组件，层级高于webview。因此存在一个严重的bug，无论怎么设置z-index，textarea都会在最上方，小程序对此提供了<a href="https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html" target="_blank" rel="noopener noreferrer">cover-view<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html" target="_blank" rel="noopener noreferrer">cover-image<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>组件，但是cover-view中只能包含这两种组件，基本用不上。</p> <p>唯一的办法就是切换textarea的显示，在弹窗都时候隐藏textarea。但是当前项目做题页面要能够左右滑动，此时textarea就无法隐藏了，我目前的解决方案是平时将textarea替换为普通的view显示，点击时修改为textarea，blur时再替换为view。这样唯一的问题就是用户需要点两次输入框才能编辑。textarea自带的focus属性并不能解决问题。</p> <h3 id="富文本解析及内存"><a href="#富文本解析及内存" class="header-anchor">#</a> 富文本解析及内存</h3> <p>小程序对富文本的支持很差，原生<a href="https://developers.weixin.qq.com/miniprogram/dev/component/rich-text.html" target="_blank" rel="noopener noreferrer">rich-text<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>对象需要的数据格式为节点对象，且无法对内部图片等再设置属性和点击预览等。使用最多的库是<a href="https://github.com/icindy/wxParse" target="_blank" rel="noopener noreferrer">wxParse<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>下载wxParse相关文件放到libs中。在要使用的页面引入js文件，并调用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> WxParse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../libs/wxParse/wxParse.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
WxParse<span class="token punctuation">.</span><span class="token function">wxParse</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">question</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTopicQuestion</span><span class="token punctuation">(</span>curTopic<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>会在页面的data中创建一个question的字段，值为解析后的节点对象。</p> <p>在wxml中使用：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>../../libs/wxParse/wxParse.wxml<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wxParse<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{wxParseData:question}}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>这里的做题页一套卷子有几十道题，用<a href="https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html" target="_blank" rel="noopener noreferrer">swiper<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>组件左右切换。wxParse提供了一个wxParseTemArray方法，用法如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> replyArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  WxParse<span class="token punctuation">.</span><span class="token function">wxParse</span><span class="token punctuation">(</span><span class="token string">'reply'</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">,</span> replyArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> that<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> replyArr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    WxParse<span class="token punctuation">.</span><span class="token function">wxParseTemArray</span><span class="token punctuation">(</span><span class="token string">&quot;replyTemArray&quot;</span><span class="token punctuation">,</span><span class="token string">'reply'</span><span class="token punctuation">,</span> replyArr<span class="token punctuation">.</span>length<span class="token punctuation">,</span> that<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{replyTemArray}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  回复{{index}}:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wxParse<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{wxParseData:item}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>初始代码遍历题目数组，对每一道题进行富文本解析并放到swiper中渲染，性能很差。在wxml中通过wx:if做判断，只有当前题目及相邻题目进行渲染，其他swiper-item内容为空，性能得到提升。但是在进入第一道题时，解析几十个富文本并放到内存，加载依然很慢，切换时很卡。</p> <p>对富文本做动态解析，只解析当前题目及相邻题目，创建prevQuestion，curQuestion，nextQuestion，加载很快，但是切换时屏幕会闪，因为滑动时，下一题正常显示nextQuestion，但是滑动结束后，先显示curQuestion，再显示新的curQuestion。</p> <p>思路回到之前的数组，对每道题目，不能使用相同的wxParse字段。在初始化时，解析前三道题目，每次滑动时，解析新的题目。</p> <div class="language-js extra-class"><pre class="language-js"><code>WxParse<span class="token punctuation">.</span><span class="token function">wxParse</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">question_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>curIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTopicQuestion</span><span class="token punctuation">(</span>curTopic<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>但是在wxml中，无法使用拼接的变量名，尝试用[]无效。我们需要一个数组进行包裹。创建一个数组，直接赋值并在页面使用数组对应索引。</p> <div class="language-js extra-class"><pre class="language-js"><code>questions<span class="token punctuation">[</span>curIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">question_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>curIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodes<span class="token punctuation">;</span>
</code></pre></div><p>这时还有一个性能问题，就是切换题目时不断创建新的字段到data，内存越来越大。翻页时，直接获取data对象，删除对应字段，重新setData，发现出现闪动。把不用的题目字段赋值为null，依然在内存显示。赋值为undefined，从内存消失。</p> <h3 id="富文本图片大小"><a href="#富文本图片大小" class="header-anchor">#</a> 富文本图片大小</h3> <p>wxParse会对解析的图片设置图片预览，并分析图片大小设置图片属性。</p> <p>从wxParse.js代码可以看到，对设置了width和height的图片，将其读取到了图片的attr中；对于没有设置宽高的图片，获取其实际宽高；对于没有设置宽高且实际宽度大于屏幕宽度的，设置宽度为屏幕宽度。</p> <p>这里我们的试题富文本中，图片有设置宽高，发现插件按照屏幕宽度进行了渲染。打开wxParse.wxml，找到图片模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wxParseImg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.classStr}} wxParse-{{item.tag}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-from</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.from}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.attr.src}}<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">data-idx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.imgIndex}}<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.attr.src}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>widthFix<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wxParseImgLoad<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wxParseImgTap<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token selector">width:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item.width<span class="token punctuation">}</span><span class="token punctuation">}</span>px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>加上宽高属性，发现大部分图片正常。但是少数图片实际宽度大于屏幕宽度，再加上max-width。最终代码如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wxParseImg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.classStr}} wxParse-{{item.tag}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-from</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.from}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.attr.src}}<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">data-idx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.imgIndex}}<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.attr.src}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>widthFix<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wxParseImgLoad<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wxParseImgTap<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token selector">width:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item.attr.width<span class="token punctuation">}</span><span class="token punctuation">}</span>px<span class="token selector">; height:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>item.attr.height<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="组件传值"><a href="#组件传值" class="header-anchor">#</a> 组件传值</h3> <p>自定义组件可接收props，使用时从this.data.xxx取值。之前传递了一个叫data的prop，发现this.data和this.data.data循环引用了，导致取其他prop时取不到值。</p> <h3 id="组件slot渲染错误"><a href="#组件slot渲染错误" class="header-anchor">#</a> 组件slot渲染错误</h3> <p>小程序自定义组件支持slot。使用中遇到slot中元素未渲染到父节点下，而是渲染为兄弟节点。搜索发现其他人也遇到这个问题，暂时无解。</p> <h3 id="第三方授权客服和模板消息"><a href="#第三方授权客服和模板消息" class="header-anchor">#</a> 第三方授权客服和模板消息</h3> <p>小程序可使用微信自带的客服和模板消息。</p> <p>在微信设置客服，页面使用button，设置open-type=&quot;contact&quot;即可。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>contact<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>联系客服<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>当使用第三方授权时，如果授权了客服，则不会发送消息到自带客服，即使尚未开启消息推送。</p> <p>在未开启消息推送时，可使用自带模板消息，在公众平台选择模板和字段，用form提交。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">report-submit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindsubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>formSubmit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">form-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>推送模板<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">formSubmit</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">sendTemplateMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    appId<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      keyword1<span class="token punctuation">.</span><span class="token constant">DATA</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      keyword2<span class="token punctuation">.</span><span class="token constant">DATA</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    formId<span class="token operator">:</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>formId<span class="token punctuation">,</span>
    openId<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    templateId<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">11/2/2019, 4:42:17 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.df436686.js" defer></script><script src="/assets/js/21.3e37a615.js" defer></script>
  </body>
</html>
